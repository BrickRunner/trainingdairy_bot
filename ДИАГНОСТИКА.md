# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã "–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è"

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ —Ü–µ–ª–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª "–ú–æ–∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è", –Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è.

## ‚úÖ –ß—Ç–æ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º "–ú–æ–∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è"**
   - –í `save_all_distances_and_redirect()` - —Å—Ç—Ä–æ–∫–∞ 1078
   - –í `process_target_time()` - —Å—Ç—Ä–æ–∫–∞ 1501
   - –ó–∞–¥–µ—Ä–∂–∫–∞ 0.2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î

2. **–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –í `save_all_distances_and_redirect()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –í `show_my_competitions()` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```bash
python bot.py
```

### –®–∞–≥ 2: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ù–∞–π—Ç–∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è"
2. –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥, –ø–µ—Ä–∏–æ–¥, —Å–ø–æ—Ä—Ç, —Å–µ—Ä–≤–∏—Å
3. –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–æ–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ
4. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é
5. –í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

–õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

```
INFO - Saving X distances to database...
INFO - All distances saved successfully
INFO - VERIFICATION: User XXXXX now has Y upcoming competitions
INFO - Showing success message for X distances
INFO - show_my_competitions called for user_id=XXXXX
INFO - Got Y upcoming competitions for user XXXXX
```

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

### 1. –î–∞—Ç–∞ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ—à–ª–æ–º
**–°–∏–º–ø—Ç–æ–º:** –í –ª–æ–≥–∞—Ö `VERIFICATION` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π
**–ü—Ä–∏—á–∏–Ω–∞:** –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å –¥–∞—Ç–æ–π < —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—É –≤ `comp_data['begin_date']`

–ü—Ä–æ–≤–µ—Ä–∫–∞:
```python
# –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
Added new competition with id=X, date=2026-XX-XX
```

–ï—Å–ª–∏ –¥–∞—Ç–∞ < 2025-12-12, —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ `upcoming`.

### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å form at SQL –∑–∞–ø—Ä–æ—Å–µ
**–°–∏–º–ø—Ç–æ–º:** `VERIFICATION` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç N —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π, –Ω–æ `show_my_competitions` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0
**–ü—Ä–∏—á–∏–Ω–∞:** –†–∞–∑–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ —É—Å–ª–æ–≤–∏—è –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
**–†–µ—à–µ–Ω–∏–µ:** –°—Ä–∞–≤–Ω–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å—ã

### 3. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `edit_text`
**–ü—Ä–∏—á–∏–Ω–∞:** –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ
**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ 0.2 —Å–µ–∫—É–Ω–¥—ã

### 4. State –æ—á–∏—â–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ
**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Å–ª–µ `state.clear()` —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω—ã
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `show_my_competitions` –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç state

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
python test_full_scenario.py
```

–ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î –Ω–∞–ø—Ä—è–º—É—é:

```python
import asyncio
import aiosqlite

async def check_db():
    async with aiosqlite.connect('data/competition.db') as db:
        # –í–∞—à user_id
        user_id = –í–ê–®–ï_ID

        cursor = await db.execute(
            """
            SELECT c.name, c.date, cp.target_time
            FROM competitions c
            JOIN competition_participants cp ON c.id = cp.competition_id
            WHERE cp.user_id = ? AND c.date >= date('now')
            """,
            (user_id,)
        )
        rows = await cursor.fetchall()
        for row in rows:
            print(row)

asyncio.run(check_db())
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ**
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** - –Ω–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å `VERIFICATION` –∏ `show_my_competitions`
3. **–°–æ–æ–±—â–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
   - –°–∫–æ–ª—å–∫–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `VERIFICATION`?
   - –°–∫–æ–ª—å–∫–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `show_my_competitions`?
   - –ö–∞–∫–∞—è –¥–∞—Ç–∞ —É –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è?
   - –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö?

## üìù –ì–¥–µ –∏—Å–∫–∞—Ç—å –ª–æ–≥–∏

- Windows: `logs/bot.log` –∏–ª–∏ –∫–æ–Ω—Å–æ–ª—å –≥–¥–µ –∑–∞–ø—É—â–µ–Ω –±–æ—Ç
- –ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ:
  - `VERIFICATION:`
  - `show_my_competitions called`
  - `Got X upcoming competitions`
  - `Added new competition with id`

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤ –º—ã —Å–º–æ–∂–µ–º —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã! üîç
