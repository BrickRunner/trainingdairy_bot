# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è reg.place - –í–µ—Ä—Å–∏—è 3

## –î–∞—Ç–∞: 2025-12-17

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. ‚ùå –î–∏—Å—Ç–∞–Ω—Ü–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –¥–µ—Ç–∞–ª—è—Ö —Å–æ–±—ã—Ç–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç reg.place –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è, —Ö–æ—Ç—è –≤ –∫–æ–¥–µ –µ—Å—Ç—å –ª–æ–≥–∏–∫–∞ –∏—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

**–ü—Ä–∏—á–∏–Ω–∞:** –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –Ω–µ –ø–∞—Ä—Å—è—Ç—Å—è –∏–∑ API –∏–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π –≤ [regplace_parser.py:271-293](competitions/regplace_parser.py#L271-L293)

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ª–æ–≥–∏:**
```python
logger.debug(f"Event '{name}' has races: {bool(races)}, type: {type(races)}, count: {len(races)}")
# –î–ª—è –∫–∞–∂–¥–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏:
logger.debug(f"  Added distance: {distance_km} km, name: {distance_name}")
logger.warning(f"  Failed to parse distance: {distance}, error: {e}")
logger.debug(f"  Skipping race without distance: {race}")
# –ò—Ç–æ–≥–æ:
logger.info(f"Event '{name}' parsed with {len(distances)} distances")
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö:**
```
DEBUG:competitions.regplace_parser:Event '–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –º–∞—Ä–∞—Ñ–æ–Ω' has races: True, type: <class 'list'>, count: 5
DEBUG:competitions.regplace_parser:  Added distance: 5.0 km, name: 5 –∫–º
DEBUG:competitions.regplace_parser:  Added distance: 10.0 km, name: 10 –∫–º
INFO:competitions.regplace_parser:Event '–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –º–∞—Ä–∞—Ñ–æ–Ω' parsed with 5 distances
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –µ—Å–ª–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –Ω–µ –ø–∞—Ä—Å—è—Ç—Å—è:**
- API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–µ `races`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `races` –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è (–Ω–µ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π)
- –ü–æ–ª–µ `distance` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- –ó–Ω–∞—á–µ–Ω–∏–µ `distance` —Ä–∞–≤–Ω–æ 0 –∏–ª–∏ None

#### 2. ‚ùå –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≤–≤–æ–¥–µ —Ü–µ–ª–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –≤–≤–æ–¥–µ —Ü–µ–ª–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å–æ–±—ã—Ç–∏—è reg.place –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ –¥–µ—Ç–∞–ª—è–º —Å–æ–±—ã—Ç–∏—è.

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π callback –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `prompt_for_target_time()` - –±—ã–ª–æ `comp:detail:{comp_id}` –≤–º–µ—Å—Ç–æ `compdetail:{comp_id}`

**–ì–¥–µ:** [upcoming_competitions_handlers.py:1209](competitions/upcoming_competitions_handlers.py#L1209)

**–ë—ã–ª–æ:**
```python
builder.row(InlineKeyboardButton(text="‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data=f"comp:detail:{comp_id}"))
```

**–°—Ç–∞–ª–æ:**
```python
builder.row(InlineKeyboardButton(text="‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data=f"compdetail:{comp_id}"))
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –¥–µ—Ç–∞–ª—è–º —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, –≥–¥–µ –æ–Ω –º–æ–∂–µ—Ç:
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–±—ã—Ç–∏–∏
- –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π
- –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è reg.place

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–±—ã—Ç–∏–µ —Å –¥–∏—Å—Ç–∞–Ω—Ü–∏—è–º–∏

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–Ø —É—á–∞—Å—Ç–≤—É—é"** ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `participate_in_competition()`
2. **–ï—Å–ª–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π > 1:**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ (—Å—Ç—Ä–æ–∫–∞ 754: –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" ‚Üí –¥–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è)
   - –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ ‚Üí –≤–≤–æ–¥ —Ü–µ–ª–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∫–∞–∂–¥–æ–π (—Å—Ç—Ä–æ–∫–∏ 1035-1045: –∫–Ω–æ–ø–∫–∞ "–ö –≤—ã–±–æ—Ä—É –¥–∏—Å—Ç–∞–Ω—Ü–∏–π" –∏–ª–∏ "–ù–∞–∑–∞–¥")
3. **–ï—Å–ª–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏—è == 1:**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è
   - –ü–µ—Ä–µ—Ö–æ–¥ –∫ `prompt_for_target_time()` (—Å—Ç—Ä–æ–∫–∞ 1209: –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" ‚Üí –¥–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è) ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**
4. **–í–≤–æ–¥ –≤—Ä–µ–º–µ–Ω–∏:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –≤—Ä–µ–º—è –∏–ª–∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
   - –ü–µ—Ä–µ—Ö–æ–¥ –≤ "–ú–æ–∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ–±—ã—Ç–∏–µ –±–µ–∑ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π (HeroLeague)

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–Ø —É—á–∞—Å—Ç–≤—É—é"** ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `participate_in_competition()`
2. **–ï—Å–ª–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π == 0 –∏ —Å–µ—Ä–≤–∏—Å == HeroLeague:**
   - –ü—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –≤—Ä—É—á–Ω—É—é (—Å—Ç—Ä–æ–∫–∞ 825: –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" ‚Üí –¥–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è)
   - –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ ‚Üí –≤–≤–æ–¥ —Ü–µ–ª–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å—Ç—Ä–æ–∫–∞ 1452: –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" –∏ "–ù–∞–∑–∞–¥")
3. **–î–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤–∫–ª—é—á–∞—è reg.place):**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –±–µ–∑ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
   - –ü–µ—Ä–µ—Ö–æ–¥ –∫ `prompt_for_target_time()` (—Å—Ç—Ä–æ–∫–∞ 1209: –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" ‚Üí –¥–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è) ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –î–∏—Å—Ç–∞–Ω—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç reg.place
2. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –í –æ–ø–∏—Å–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è –µ—Å—Ç—å —Å–µ–∫—Ü–∏—è "üìè –î–∏—Å—Ç–∞–Ω—Ü–∏–∏:" —Å–æ —Å–ø–∏—Å–∫–æ–º –¥–∏—Å—Ç–∞–Ω—Ü–∏–π
3. **–ï—Å–ª–∏ –Ω–µ—Ç:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ –ø–∞—Ä—Å–∏–Ω–≥–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π

### –¢–µ—Å—Ç 2: –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç reg.place —Å –¥–∏—Å—Ç–∞–Ω—Ü–∏—è–º–∏
2. –ù–∞–∂–º–∏—Ç–µ "–Ø —É—á–∞—Å—Ç–≤—É—é"
3. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ) –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥–µ—Ç–µ –Ω–∞ –≤–≤–æ–¥ –≤—Ä–µ–º–µ–Ω–∏ (–µ—Å–ª–∏ –æ–¥–Ω–∞)
4. –ù–∞ —ç–∫—Ä–∞–Ω–µ –≤–≤–æ–¥–∞ —Ü–µ–ª–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–∂–º–∏—Ç–µ "‚óÄÔ∏è –ù–∞–∑–∞–¥"
5. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –í–æ–∑–≤—Ä–∞—Ç –∫ –¥–µ—Ç–∞–ª—è–º —Å–æ–±—ã—Ç–∏—è —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–Ø —É—á–∞—Å—Ç–≤—É—é", "–ö —Å–ø–∏—Å–∫—É", "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"
6. **–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback `compdetail:{comp_id}`

### –¢–µ—Å—Ç 3: –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –¥–ª—è —Å–æ–±—ã—Ç–∏–π –±–µ–∑ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π
1. –ï—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ reg.place –Ω–µ –∏–º–µ–µ—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏–π
2. –ù–∞–∂–º–∏—Ç–µ "–Ø —É—á–∞—Å—Ç–≤—É—é"
3. –ü–æ–ø–∞–¥–µ—Ç–µ —Å—Ä–∞–∑—É –Ω–∞ –≤–≤–æ–¥ —Ü–µ–ª–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
4. –ù–∞–∂–º–∏—Ç–µ "‚óÄÔ∏è –ù–∞–∑–∞–¥"
5. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –í–æ–∑–≤—Ä–∞—Ç –∫ –¥–µ—Ç–∞–ª—è–º —Å–æ–±—ã—Ç–∏—è

---

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ü—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Å–æ–±—ã—Ç–∏–π:
```
INFO:competitions.regplace_parser:Trying reg.place endpoint: https://api.reg.place/v1/events
INFO:competitions.regplace_parser:SUCCESS! reg.place endpoint https://api.reg.place/v1/events returned status 200
INFO:competitions.regplace_parser:reg.place event structure keys: ['id', 'slug', 'name', ...]
DEBUG:competitions.regplace_parser:Event '–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –º–∞—Ä–∞—Ñ–æ–Ω' has races: True, type: <class 'list'>, count: 5
DEBUG:competitions.regplace_parser:  Added distance: 5.0 km, name: 5 –∫–º
INFO:competitions.regplace_parser:Event '–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –º–∞—Ä–∞—Ñ–æ–Ω' parsed with 5 distances
```

### –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π —Å–æ–±—ã—Ç–∏—è:
```
INFO:competitions.upcoming_competitions_handlers:Button logic: is_participant=False, distances_count=3
INFO:competitions.upcoming_competitions_handlers:Showing: ‚úÖ –Ø —É—á–∞—Å—Ç–≤—É—é (not registered)
```

### –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥":
```
INFO:aiogram.event:Update ... handling callback_query: compdetail:event-slug
```

---

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. ‚úÖ [competitions/regplace_parser.py](competitions/regplace_parser.py) - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π
2. ‚úÖ [competitions/upcoming_competitions_handlers.py](competitions/upcoming_competitions_handlers.py#L1209) - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω callback –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
3. ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω, –æ—à–∏–±–æ–∫ –Ω–µ—Ç

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **v3 (2025-12-17):** –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
- **v2 (2025-12-17):** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã URL –∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–µ—Ä–∏–æ–¥—É
- **v1 (2025-12-17):** –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è reg.place
