# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ—Ç–ª–∞–¥–∫–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –º–µ—Ç—Ä–∏–∫

## –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–Ø –¥–æ–±–∞–≤–∏–ª –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. **health_handlers.py** - —Ñ—É–Ω–∫—Ü–∏—è `save_and_finish()` (—Å—Ç—Ä–æ–∫–∞ 377)
   - –õ–æ–≥–∏—Ä—É–µ—Ç —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ state –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
   - –õ–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ save_health_metrics

2. **health_queries.py** - —Ñ—É–Ω–∫—Ü–∏—è `save_health_metrics()` (—Å—Ç—Ä–æ–∫–∞ 16)
   - –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –õ–æ–≥–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –∑–∞–ø–∏—Å—å
   - –õ–æ–≥–∏—Ä—É–µ—Ç SQL –∑–∞–ø—Ä–æ—Å—ã UPDATE/INSERT
   - –õ–æ–≥–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç—å commit

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
   ```bash
   python bot.py
   ```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –±–æ—Ç–µ:
   - –ù–∞–∂–º–∏—Ç–µ "‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ"
   - –ù–∞–∂–º–∏—Ç–µ "üìù –í–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ"
   - –í–≤–µ–¥–∏—Ç–µ **–ø—É–ª—å—Å** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 65)
   - –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –º–µ–Ω—é "üìù –í–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ"
   - –í–≤–µ–¥–∏—Ç–µ **–≤–µ—Å** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 72)
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –ª–∏ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è

3. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ - –æ–Ω–∏ –ø–æ–∫–∞–∂—É—Ç:
   - –ß—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ state –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
   - –ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –ë–î
   - –ö–∞–∫–æ–π SQL –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   - –£—Å–ø–µ—à–µ–Ω –ª–∏ commit

## –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö

### –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—É–ª—å—Å–∞ (–ø–µ—Ä–≤—ã–π —Ä–∞–∑):
```
INFO: save_and_finish: data from state = {'pulse': 65, 'quick_input': 'pulse'}
INFO: save_and_finish: save_params = {'user_id': XXX, 'metric_date': 'YYYY-MM-DD', 'morning_pulse': 65}
INFO: save_health_metrics called: user_id=XXX, date=YYYY-MM-DD, pulse=65, weight=None, sleep=None
INFO: Existing record: None
INFO: INSERT new record with values: pulse=65, weight=None, sleep=None
INFO: Commit successful
```

### –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞ (–≤—Ç–æ—Ä–æ–π —Ä–∞–∑):
```
INFO: save_and_finish: data from state = {'weight': 72.0, 'quick_input': 'weight'}
INFO: save_and_finish: save_params = {'user_id': XXX, 'metric_date': 'YYYY-MM-DD', 'weight': 72.0}
INFO: save_health_metrics called: user_id=XXX, date=YYYY-MM-DD, pulse=None, weight=72.0, sleep=None
INFO: Existing record: (1,)
INFO: UPDATE query: UPDATE health_metrics SET weight = ?, updated_at = CURRENT_TIMESTAMP WHERE user_id = ? AND date = ?
INFO: UPDATE params: [72.0, XXX, 'YYYY-MM-DD']
INFO: Commit successful
```

## –ü—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ –ª–æ–≥–∏

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏, –æ—Å–æ–±–µ–Ω–Ω–æ:
1. –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—É–ª—å—Å–∞
2. –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞
3. –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞!
