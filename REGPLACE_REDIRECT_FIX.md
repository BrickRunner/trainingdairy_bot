# Исправление редиректа reg.place после ввода целевого времени

## Дата: 2025-12-19

## Проблема

После регистрации на соревнование reg.place пользователь видел сообщение:
```
✅ МОИ СОРЕВНОВАНИЯ

У вас пока нет запланированных соревнований.
```

Хотя в разделе "Мои соревнования" есть много событий от других парсеров (RussiaRunning, Timerman, HeroLeague).

## Причина проблемы

Парсер reg.place возвращал события с датами в ПРОШЛОМ:
- При фильтре "1 год" показывались события с 01.01 до 31.12 текущего года
- Если сегодня 19.12.2025, то события из января-ноября 2025 уже в прошлом
- Эти события сохранялись в базу данных
- Но при показе "upcoming competitions" они фильтровались как прошедшие
- В результате пользователь видел "нет соревнований"

## Решение

Добавлена дополнительная проверка в `competitions/regplace_parser.py` (строки 204-216):

```python
# Дополнительная проверка: событие должно быть в будущем (>= сегодня)
comp_date = comp.get('start_time')
if comp_date:
    if comp_date.tzinfo is None:
        from datetime import timezone as tz
        comp_date = comp_date.replace(tzinfo=tz.utc)

    # Проверяем что событие не в прошлом
    from datetime import timezone, timedelta
    now_utc = datetime.now(timezone.utc)
    if comp_date < now_utc:
        logger.debug(f"Skipping past event: '{comp.get('title')}' on {comp_date.strftime('%Y-%m-%d')}")
        continue
```

## Результат

- События из прошлого НЕ показываются в списке reg.place
- События из прошлого НЕ сохраняются в базу данных
- После регистрации на reg.place соревнование пользователь видит его в "Мои соревнования"
- Редирект работает точно так же как в RussiaRunning, Timerman, HeroLeague

## Важно

Редирект после ввода целевого времени УЖЕ БЫЛ одинаковым для всех парсеров!
Все парсеры (RussiaRunning, Timerman, HeroLeague, reg.place) используют:
- Одни и те же функции в `competitions/upcoming_competitions_handlers.py`
- Одинаковую логику сохранения в базу
- Одинаковый редирект через `show_my_competitions()`

Проблема была ТОЛЬКО в том, что reg.place показывал события из прошлого.

## Файлы изменены

1. **`competitions/regplace_parser.py`** (строки 204-216)
   - Добавлена проверка что событие в будущем
   - События из прошлого пропускаются

## Тестирование

1. Выберите сервис "reg.place"
2. Найдите соревнование
3. Нажмите "Я участвую"
4. Введите целевое время
5. Проверьте что попали в "✅ МОИ СОРЕВНОВАНИЯ" и там есть ваше соревнование

---

✅ **Проблема решена!**
