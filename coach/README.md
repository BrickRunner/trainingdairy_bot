# –ú–æ–¥—É–ª—å "–¢—Ä–µ–Ω–µ—Ä"

–ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–µ–Ω–µ—Ä–∞–º–∏ –∏ —É—á–µ–Ω–∏–∫–∞–º–∏ –≤ Training Diary Bot.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –î–ª—è —Ç—Ä–µ–Ω–µ—Ä–æ–≤:
- ‚úÖ –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ç—Ä–µ–Ω–µ—Ä–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞/—Å—Å—ã–ª–∫–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ —Å–≤–æ–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —É—á–µ–Ω–∏–∫–µ
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —É—á–µ–Ω–∏–∫–∞
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É—á–µ–Ω–∏–∫–∞ (–Ω–µ–¥–µ–ª—è/2 –Ω–µ–¥–µ–ª–∏/–º–µ—Å—è—Ü)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è —É—á–µ–Ω–∏–∫–∞ (–≤–∫–ª—é—á–∞—è –±—É–¥—É—â–∏–µ –¥–∞—Ç—ã)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Å–µ–≤–¥–æ–Ω–∏–º–∞ —É—á–µ–Ω–∏–∫–∞ (–≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ —Ç—Ä–µ–Ω–µ—Ä—É)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º —É—á–µ–Ω–∏–∫–∞
- üîÑ –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –æ –∑–¥–æ—Ä–æ–≤—å–µ —É—á–µ–Ω–∏–∫–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

### –î–ª—è —É—á–µ–Ω–∏–∫–æ–≤:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç—Ä–µ–Ω–µ—Ä—É –ø–æ –∫–æ–¥—É –∏–ª–∏ —Å—Å—ã–ª–∫–µ
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–≤–æ—ë–º —Ç—Ä–µ–Ω–µ—Ä–µ
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç —Ç—Ä–µ–Ω–µ—Ä–∞
- üîÑ –¢—Ä–µ–Ω–µ—Ä –≤–∏–¥–∏—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —É—á–µ–Ω–∏–∫–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
coach/
‚îú‚îÄ‚îÄ __init__.py                      # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ coach_queries.py                 # –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î (–±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
‚îú‚îÄ‚îÄ coach_training_queries.py        # –ó–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏
‚îú‚îÄ‚îÄ coach_keyboards.py               # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îú‚îÄ‚îÄ coach_handlers.py                # –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ coach_add_training_handlers.py   # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
‚îú‚îÄ‚îÄ README.md                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ FEATURE_PLAN.md                  # –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
‚îî‚îÄ‚îÄ PRIORITY1_COMPLETE.md            # –û—Ç—á—ë—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ Priority 1
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `user_settings`
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:
- `is_coach` (BOOLEAN) - —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–µ–Ω–µ—Ä–æ–º
- `coach_link_code` (TEXT UNIQUE) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤

### –¢–∞–±–ª–∏—Ü–∞ `coach_links`
```sql
CREATE TABLE coach_links (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    coach_id INTEGER NOT NULL,
    student_id INTEGER NOT NULL,
    status TEXT DEFAULT 'active',  -- 'active', 'pending', 'removed'
    link_code TEXT UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    removed_at TIMESTAMP,
    coach_nickname TEXT,  -- –ü—Å–µ–≤–¥–æ–Ω–∏–º —É—á–µ–Ω–∏–∫–∞ (–≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ —Ç—Ä–µ–Ω–µ—Ä—É)
    UNIQUE(coach_id, student_id),
    FOREIGN KEY (coach_id) REFERENCES users(id),
    FOREIGN KEY (student_id) REFERENCES users(id)
)
```

### –¢–∞–±–ª–∏—Ü–∞ `trainings` (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)
```sql
-- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–µ—Ä–æ–º
ALTER TABLE trainings ADD COLUMN added_by_coach_id INTEGER;  -- ID —Ç—Ä–µ–Ω–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–∏–ª
ALTER TABLE trainings ADD COLUMN is_planned BOOLEAN DEFAULT 0;  -- –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
```

### –¢–∞–±–ª–∏—Ü–∞ `training_comments`
```sql
CREATE TABLE training_comments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    training_id INTEGER NOT NULL,
    author_id INTEGER NOT NULL,
    comment TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (training_id) REFERENCES trainings(id),
    FOREIGN KEY (author_id) REFERENCES users(id)
)
```

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –°—Ç–∞—Ç—å —Ç—Ä–µ–Ω–µ—Ä–æ–º:
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
2. –ù–∞–∂–∞—Ç—å "‚ùå –†–µ–∂–∏–º —Ç—Ä–µ–Ω–µ—Ä–∞" (–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ "‚úÖ –†–µ–∂–∏–º —Ç—Ä–µ–Ω–µ—Ä–∞")
3. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤
4. –í –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä"

### –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ç—Ä–µ–Ω–µ—Ä—É (—É—á–µ–Ω–∏–∫):
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
2. –ù–∞–∂–∞—Ç—å "üë®‚Äçüè´ –ú–æ–π —Ç—Ä–µ–Ω–µ—Ä"
3. –ù–∞–∂–∞—Ç—å "‚úèÔ∏è –í–≤–µ—Å—Ç–∏ –∫–æ–¥ —Ç—Ä–µ–Ω–µ—Ä–∞"
4. –í–≤–µ—Å—Ç–∏ –∫–æ–¥, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç —Ç—Ä–µ–Ω–µ—Ä–∞

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ: –ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ –≤–∏–¥–∞ `https://t.me/botname?start=coach_XXXXXXXX`

## API —Ñ—É–Ω–∫—Ü–∏–π

### coach_queries.py

```python
async def set_coach_mode(user_id: int, is_coach: bool) -> str:
    """–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Ç—Ä–µ–Ω–µ—Ä–∞"""

async def is_user_coach(user_id: int) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–µ–Ω–µ—Ä–æ–º"""

async def get_coach_link_code(user_id: int) -> Optional[str]:
    """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ —Ç—Ä–µ–Ω–µ—Ä–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤"""

async def find_coach_by_code(link_code: str) -> Optional[int]:
    """–ù–∞–π—Ç–∏ —Ç—Ä–µ–Ω–µ—Ä–∞ –ø–æ –∫–æ–¥—É"""

async def add_student_to_coach(coach_id: int, student_id: int) -> bool:
    """–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞ –∫ —Ç—Ä–µ–Ω–µ—Ä—É"""

async def remove_student_from_coach(coach_id: int, student_id: int) -> bool:
    """–£–¥–∞–ª–∏—Ç—å —É—á–µ–Ω–∏–∫–∞ –æ—Ç —Ç—Ä–µ–Ω–µ—Ä–∞"""

async def get_coach_students(coach_id: int) -> List[Dict[str, Any]]:
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤ —Ç—Ä–µ–Ω–µ—Ä–∞"""

async def get_student_coach(student_id: int) -> Optional[Dict[str, Any]]:
    """–ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–µ–Ω–µ—Ä–∞ —É—á–µ–Ω–∏–∫–∞"""

async def remove_coach_from_student(student_id: int) -> bool:
    """–£—á–µ–Ω–∏–∫ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç —Ç—Ä–µ–Ω–µ—Ä–∞"""
```

## FSM States

```python
class CoachStates(StatesGroup):
    waiting_for_coach_code = State()  # –í–≤–æ–¥ –∫–æ–¥–∞ —Ç—Ä–µ–Ω–µ—Ä–∞
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### main.py
```python
from coach.coach_handlers import router as coach_router
dp.include_router(coach_router)
```

### bot/handlers.py
```python
@router.message(F.text == "üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä")
async def show_coach_section(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –¢—Ä–µ–Ω–µ—Ä"""
```

### settings/settings_handlers_full.py
```python
@router.callback_query(F.data == "settings:coach_mode")
async def toggle_coach_mode(callback: CallbackQuery):
    """–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ç—Ä–µ–Ω–µ—Ä–∞"""
```

## –ú–∏–≥—Ä–∞—Ü–∏—è

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î:
```bash
python migrate_coach_mode.py
```

## –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç—Ä–µ–Ω–µ—Ä—É —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç—Ä–µ–Ω–µ—Ä–∞ –∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º —É—á–µ–Ω–∏–∫–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Ç—Ä–µ–Ω–µ—Ä ‚Üí —É—á–µ–Ω–∏–∫)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É—á–µ–Ω–∏–∫–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —É—á–µ–Ω–∏–∫–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å —á–∞—Ç —Ç—Ä–µ–Ω–µ—Ä-—É—á–µ–Ω–∏–∫

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –û–¥–∏–Ω —É—á–µ–Ω–∏–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–∏–º —Ç—Ä–µ–Ω–µ—Ä–æ–º
- –¢—Ä–µ–Ω–µ—Ä –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–µ–Ω–∏–∫–æ–≤
- –ö–æ–¥ —Ç—Ä–µ–Ω–µ—Ä–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞ (8 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–∫–≤—ã+—Ü–∏—Ñ—Ä—ã)
- –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞ —Ç—Ä–µ–Ω–µ—Ä–∞ –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (–º–æ–∂–Ω–æ —Å–Ω–æ–≤–∞ –≤–∫–ª—é—á–∏—Ç—å)
