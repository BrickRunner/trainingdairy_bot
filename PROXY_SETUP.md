# Настройка прокси для доступа к Telegram API

Если у вас возникают проблемы с подключением к Telegram API (ошибка `Connection reset by peer`), это может означать, что доступ к api.telegram.org заблокирован в вашей стране или сети.

## Решения

### Вариант 1: Использование VPN (Рекомендуется)

Самый простой способ - запустить бота через VPN:

1. Установите и запустите VPN на вашем сервере/компьютере
2. Убедитесь, что VPN работает: `ping api.telegram.org`
3. Запустите бота обычным способом

### Вариант 2: Настройка HTTP/SOCKS прокси

Если у вас есть доступ к прокси-серверу:

1. Откройте файл `.env` в корне проекта
2. Добавьте строку с URL вашего прокси:

```env
# Для HTTP прокси
PROXY_URL=http://proxy.example.com:8080

# Для SOCKS5 прокси с авторизацией
PROXY_URL=socks5://username:password@proxy.example.com:1080

# Для SOCKS5 прокси без авторизации
PROXY_URL=socks5://proxy.example.com:1080
```

3. Перезапустите бота

### Вариант 3: Использование локального прокси

#### Использование SSH туннеля (Linux/macOS)

```bash
# Создаем SOCKS5 прокси через SSH
ssh -D 1080 -f -C -q -N your-server.com

# В .env добавляем
PROXY_URL=socks5://localhost:1080
```

#### Использование Shadowsocks

1. Установите и настройте Shadowsocks клиент
2. В `.env` укажите:

```env
PROXY_URL=socks5://127.0.0.1:1080
```

## Проверка подключения

После настройки прокси бот будет автоматически пытаться подключиться через него. В логах вы увидите:

```
INFO:__main__:Попытка подключения к Telegram API... (попытка 1/5)
```

Если подключение успешно, бот начнет работать нормально.

## Автоматические повторные попытки

Бот автоматически пытается переподключиться до 5 раз с экспоненциальной задержкой:
- Попытка 1: сразу
- Попытка 2: через 5 секунд
- Попытка 3: через 10 секунд
- Попытка 4: через 20 секунд
- Попытка 5: через 40 секунд

## Диагностика проблем

### Проверка доступа к Telegram API

```bash
# Linux/macOS
curl -I https://api.telegram.org

# Windows (PowerShell)
Test-NetConnection -ComputerName api.telegram.org -Port 443
```

Если команда не работает - Telegram API заблокирован.

### Проверка прокси

```bash
# Проверка HTTP прокси
curl -x http://proxy.example.com:8080 https://api.telegram.org

# Проверка SOCKS5 прокси
curl --socks5 proxy.example.com:1080 https://api.telegram.org
```

## Бесплатные VPN-сервисы для разработки

⚠️ **Важно:** Используйте только для разработки и тестирования!

- ProtonVPN (бесплатный тариф)
- Windscribe (10 ГБ бесплатно)
- TunnelBear (500 МБ бесплатно)

## Публичные прокси-серверы

⚠️ **Не рекомендуется для продакшена!** Используйте только для тестирования.

Списки бесплатных прокси можно найти на:
- https://www.proxy-list.download/
- https://www.sslproxies.org/
- https://free-proxy-list.net/

## Дополнительная помощь

Если проблемы сохраняются:

1. Проверьте логи бота на наличие других ошибок
2. Убедитесь, что ваш токен бота правильный
3. Проверьте настройки файрвола/антивируса
4. Попробуйте запустить бота на другом сервере/компьютере
